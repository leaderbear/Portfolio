


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > XYBoxAndWhiskerRenderer</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.jfree.chart.renderer.xy</a>
</div>

<h1>Coverage Summary for Class: XYBoxAndWhiskerRenderer (org.jfree.chart.renderer.xy)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">XYBoxAndWhiskerRenderer</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    78,3%
  </span>
  <span class="absValue">
    (18/23)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    47,5%
  </span>
  <span class="absValue">
    (113/238)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/* ===========================================================
&nbsp; * JFreeChart : a free chart library for the Java(tm) platform
&nbsp; * ===========================================================
&nbsp; *
&nbsp; * (C) Copyright 2000-2022, by David Gilbert and Contributors.
&nbsp; *
&nbsp; * Project Info:  http://www.jfree.org/jfreechart/index.html
&nbsp; *
&nbsp; * This library is free software; you can redistribute it and/or modify it
&nbsp; * under the terms of the GNU Lesser General Public License as published by
&nbsp; * the Free Software Foundation; either version 2.1 of the License, or
&nbsp; * (at your option) any later version.
&nbsp; *
&nbsp; * This library is distributed in the hope that it will be useful, but
&nbsp; * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
&nbsp; * or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public
&nbsp; * License for more details.
&nbsp; *
&nbsp; * You should have received a copy of the GNU Lesser General Public
&nbsp; * License along with this library; if not, write to the Free Software
&nbsp; * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301,
&nbsp; * USA.
&nbsp; *
&nbsp; * [Oracle and Java are registered trademarks of Oracle and/or its affiliates. 
&nbsp; * Other names may be trademarks of their respective owners.]
&nbsp; *
&nbsp; * ----------------------------
&nbsp; * XYBoxAndWhiskerRenderer.java
&nbsp; * ----------------------------
&nbsp; * (C) Copyright 2003-2021, by David Browning and Contributors.
&nbsp; *
&nbsp; * Original Author:  David Browning (for Australian Institute of Marine
&nbsp; *                   Science);
&nbsp; * Contributor(s):   David Gilbert;
&nbsp; *
&nbsp; */
&nbsp;
&nbsp;package org.jfree.chart.renderer.xy;
&nbsp;
&nbsp;import java.awt.Color;
&nbsp;import java.awt.Graphics2D;
&nbsp;import java.awt.Paint;
&nbsp;import java.awt.Shape;
&nbsp;import java.awt.Stroke;
&nbsp;import java.awt.geom.Ellipse2D;
&nbsp;import java.awt.geom.Line2D;
&nbsp;import java.awt.geom.Point2D;
&nbsp;import java.awt.geom.Rectangle2D;
&nbsp;import java.io.IOException;
&nbsp;import java.io.ObjectInputStream;
&nbsp;import java.io.ObjectOutputStream;
&nbsp;import java.io.Serializable;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Collections;
&nbsp;import java.util.Iterator;
&nbsp;import java.util.List;
&nbsp;
&nbsp;import org.jfree.chart.axis.ValueAxis;
&nbsp;import org.jfree.chart.entity.EntityCollection;
&nbsp;import org.jfree.chart.event.RendererChangeEvent;
&nbsp;import org.jfree.chart.labels.BoxAndWhiskerXYToolTipGenerator;
&nbsp;import org.jfree.chart.plot.CrosshairState;
&nbsp;import org.jfree.chart.plot.PlotOrientation;
&nbsp;import org.jfree.chart.plot.PlotRenderingInfo;
&nbsp;import org.jfree.chart.plot.XYPlot;
&nbsp;import org.jfree.chart.renderer.Outlier;
&nbsp;import org.jfree.chart.renderer.OutlierList;
&nbsp;import org.jfree.chart.renderer.OutlierListCollection;
&nbsp;import org.jfree.chart.api.RectangleEdge;
&nbsp;import org.jfree.chart.internal.PaintUtils;
&nbsp;import org.jfree.chart.internal.Args;
&nbsp;import org.jfree.chart.api.PublicCloneable;
&nbsp;import org.jfree.chart.internal.SerialUtils;
&nbsp;import org.jfree.data.Range;
&nbsp;import org.jfree.data.statistics.BoxAndWhiskerXYDataset;
&nbsp;import org.jfree.data.xy.XYDataset;
&nbsp;
&nbsp;/**
&nbsp; * A renderer that draws box-and-whisker items on an {@link XYPlot}.  This
&nbsp; * renderer requires a {@link BoxAndWhiskerXYDataset}).  The example shown here
&nbsp; * is generated by the{@code BoxAndWhiskerChartDemo2.java} program
&nbsp; * included in the JFreeChart demo collection:
&nbsp; * &lt;br&gt;&lt;br&gt;
&nbsp; * &lt;img src=&quot;doc-files/XYBoxAndWhiskerRendererSample.png&quot;
&nbsp; * alt=&quot;XYBoxAndWhiskerRendererSample.png&quot;&gt;
&nbsp; * &lt;P&gt;
&nbsp; * This renderer does not include any code to calculate the crosshair point.
&nbsp; */
&nbsp;public class XYBoxAndWhiskerRenderer extends AbstractXYItemRenderer
&nbsp;        implements XYItemRenderer, Cloneable, PublicCloneable, Serializable {
&nbsp;
&nbsp;    /** For serialization. */
&nbsp;    private static final long serialVersionUID = -8020170108532232324L;
&nbsp;
&nbsp;    /** The box width. */
&nbsp;    private double boxWidth;
&nbsp;
&nbsp;    /** The paint used to fill the box. */
&nbsp;    private transient Paint boxPaint;
&nbsp;
&nbsp;    /** A flag that controls whether or not the box is filled. */
&nbsp;    private boolean fillBox;
&nbsp;
&nbsp;    /**
&nbsp;     * The paint used to draw various artifacts such as outliers, farout
&nbsp;     * symbol, average ellipse and median line.
&nbsp;     */
<b class="fc">&nbsp;    private transient Paint artifactPaint = Color.BLACK;</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Creates a new renderer for box and whisker charts.
&nbsp;     */
&nbsp;    public XYBoxAndWhiskerRenderer() {
<b class="fc">&nbsp;        this(-1.0);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Creates a new renderer for box and whisker charts.
&nbsp;     * &lt;P&gt;
&nbsp;     * Use -1 for the box width if you prefer the width to be calculated
&nbsp;     * automatically.
&nbsp;     *
&nbsp;     * @param boxWidth  the box width.
&nbsp;     */
&nbsp;    public XYBoxAndWhiskerRenderer(double boxWidth) {
<b class="fc">&nbsp;        super();</b>
<b class="fc">&nbsp;        this.boxWidth = boxWidth;</b>
<b class="fc">&nbsp;        this.boxPaint = Color.GREEN;</b>
<b class="fc">&nbsp;        this.fillBox = true;</b>
<b class="fc">&nbsp;        setDefaultToolTipGenerator(new BoxAndWhiskerXYToolTipGenerator());</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns the width of each box.
&nbsp;     *
&nbsp;     * @return The box width.
&nbsp;     *
&nbsp;     * @see #setBoxWidth(double)
&nbsp;     */
&nbsp;    public double getBoxWidth() {
<b class="fc">&nbsp;        return this.boxWidth;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Sets the box width and sends a {@link RendererChangeEvent} to all
&nbsp;     * registered listeners.
&nbsp;     * &lt;P&gt;
&nbsp;     * If you set the width to a negative value, the renderer will calculate
&nbsp;     * the box width automatically based on the space available on the chart.
&nbsp;     *
&nbsp;     * @param width  the width.
&nbsp;     *
&nbsp;     * @see #getBoxWidth()
&nbsp;     */
&nbsp;    public void setBoxWidth(double width) {
<b class="fc">&nbsp;        if (width != this.boxWidth) {</b>
<b class="fc">&nbsp;            this.boxWidth = width;</b>
<b class="fc">&nbsp;            fireChangeEvent();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns the paint used to fill boxes.
&nbsp;     *
&nbsp;     * @return The paint (possibly {@code null}).
&nbsp;     *
&nbsp;     * @see #setBoxPaint(Paint)
&nbsp;     */
&nbsp;    public Paint getBoxPaint() {
<b class="fc">&nbsp;        return this.boxPaint;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Sets the paint used to fill boxes and sends a {@link RendererChangeEvent}
&nbsp;     * to all registered listeners.
&nbsp;     *
&nbsp;     * @param paint  the paint ({@code null} permitted).
&nbsp;     *
&nbsp;     * @see #getBoxPaint()
&nbsp;     */
&nbsp;    public void setBoxPaint(Paint paint) {
<b class="fc">&nbsp;        this.boxPaint = paint;</b>
<b class="fc">&nbsp;        fireChangeEvent();</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns the flag that controls whether or not the box is filled.
&nbsp;     *
&nbsp;     * @return A boolean.
&nbsp;     *
&nbsp;     * @see #setFillBox(boolean)
&nbsp;     */
&nbsp;    public boolean getFillBox() {
<b class="fc">&nbsp;        return this.fillBox;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Sets the flag that controls whether or not the box is filled and sends a
&nbsp;     * {@link RendererChangeEvent} to all registered listeners.
&nbsp;     *
&nbsp;     * @param flag  the flag.
&nbsp;     *
&nbsp;     * @see #setFillBox(boolean)
&nbsp;     */
&nbsp;    public void setFillBox(boolean flag) {
<b class="fc">&nbsp;        this.fillBox = flag;</b>
<b class="fc">&nbsp;        fireChangeEvent();</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns the paint used to paint the various artifacts such as outliers,
&nbsp;     * farout symbol, median line and the averages ellipse.
&nbsp;     *
&nbsp;     * @return The paint (never {@code null}).
&nbsp;     *
&nbsp;     * @see #setArtifactPaint(Paint)
&nbsp;     */
&nbsp;    public Paint getArtifactPaint() {
<b class="fc">&nbsp;        return this.artifactPaint;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Sets the paint used to paint the various artifacts such as outliers,
&nbsp;     * farout symbol, median line and the averages ellipse, and sends a
&nbsp;     * {@link RendererChangeEvent} to all registered listeners.
&nbsp;     *
&nbsp;     * @param paint  the paint ({@code null} not permitted).
&nbsp;     *
&nbsp;     * @see #getArtifactPaint()
&nbsp;     */
&nbsp;    public void setArtifactPaint(Paint paint) {
<b class="fc">&nbsp;        Args.nullNotPermitted(paint, &quot;paint&quot;);</b>
<b class="fc">&nbsp;        this.artifactPaint = paint;</b>
<b class="fc">&nbsp;        fireChangeEvent();</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns the range of values the renderer requires to display all the
&nbsp;     * items from the specified dataset.
&nbsp;     *
&nbsp;     * @param dataset  the dataset ({@code null} permitted).
&nbsp;     *
&nbsp;     * @return The range ({@code null} if the dataset is {@code null}
&nbsp;     *         or empty).
&nbsp;     *
&nbsp;     * @see #findDomainBounds(XYDataset)
&nbsp;     */
&nbsp;    @Override
&nbsp;    public Range findRangeBounds(XYDataset dataset) {
<b class="fc">&nbsp;        return findRangeBounds(dataset, true);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns the box paint or, if this is {@code null}, the item
&nbsp;     * paint.
&nbsp;     *
&nbsp;     * @param series  the series index.
&nbsp;     * @param item  the item index.
&nbsp;     *
&nbsp;     * @return The paint used to fill the box for the specified item (never
&nbsp;     *         {@code null}).
&nbsp;     */
&nbsp;    protected Paint lookupBoxPaint(int series, int item) {
<b class="fc">&nbsp;        Paint p = getBoxPaint();</b>
<b class="fc">&nbsp;        if (p != null) {</b>
<b class="fc">&nbsp;            return p;</b>
&nbsp;        }
&nbsp;        else {
&nbsp;            // TODO: could change this to itemFillPaint().  For backwards
&nbsp;            // compatibility, it might require a useFillPaint flag.
<b class="nc">&nbsp;            return getItemPaint(series, item);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Draws the visual representation of a single data item.
&nbsp;     *
&nbsp;     * @param g2  the graphics device.
&nbsp;     * @param state  the renderer state.
&nbsp;     * @param dataArea  the area within which the plot is being drawn.
&nbsp;     * @param info  collects info about the drawing.
&nbsp;     * @param plot  the plot (can be used to obtain standard color
&nbsp;     *              information etc).
&nbsp;     * @param domainAxis  the domain axis.
&nbsp;     * @param rangeAxis  the range axis.
&nbsp;     * @param dataset  the dataset (must be an instance of
&nbsp;     *                 {@link BoxAndWhiskerXYDataset}).
&nbsp;     * @param series  the series index (zero-based).
&nbsp;     * @param item  the item index (zero-based).
&nbsp;     * @param crosshairState  crosshair information for the plot
&nbsp;     *                        ({@code null} permitted).
&nbsp;     * @param pass  the pass index.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public void drawItem(Graphics2D g2, XYItemRendererState state,
&nbsp;            Rectangle2D dataArea, PlotRenderingInfo info, XYPlot plot,
&nbsp;            ValueAxis domainAxis, ValueAxis rangeAxis, XYDataset dataset,
&nbsp;            int series, int item, CrosshairState crosshairState, int pass) {
&nbsp;
<b class="fc">&nbsp;        PlotOrientation orientation = plot.getOrientation();</b>
&nbsp;
<b class="fc">&nbsp;        if (orientation == PlotOrientation.HORIZONTAL) {</b>
<b class="nc">&nbsp;            drawHorizontalItem(g2, dataArea, info, plot, domainAxis, rangeAxis,</b>
&nbsp;                    dataset, series, item, crosshairState, pass);
&nbsp;        }
<b class="fc">&nbsp;        else if (orientation == PlotOrientation.VERTICAL) {</b>
<b class="fc">&nbsp;            drawVerticalItem(g2, dataArea, info, plot, domainAxis, rangeAxis,</b>
&nbsp;                    dataset, series, item, crosshairState, pass);
&nbsp;        }
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Draws the visual representation of a single data item.
&nbsp;     *
&nbsp;     * @param g2  the graphics device.
&nbsp;     * @param dataArea  the area within which the plot is being drawn.
&nbsp;     * @param info  collects info about the drawing.
&nbsp;     * @param plot  the plot (can be used to obtain standard color
&nbsp;     *              information etc).
&nbsp;     * @param domainAxis  the domain axis.
&nbsp;     * @param rangeAxis  the range axis.
&nbsp;     * @param dataset  the dataset (must be an instance of
&nbsp;     *                 {@link BoxAndWhiskerXYDataset}).
&nbsp;     * @param series  the series index (zero-based).
&nbsp;     * @param item  the item index (zero-based).
&nbsp;     * @param crosshairState  crosshair information for the plot
&nbsp;     *                        ({@code null} permitted).
&nbsp;     * @param pass  the pass index.
&nbsp;     */
&nbsp;    public void drawHorizontalItem(Graphics2D g2, Rectangle2D dataArea,
&nbsp;            PlotRenderingInfo info, XYPlot plot, ValueAxis domainAxis,
&nbsp;            ValueAxis rangeAxis, XYDataset dataset, int series,
&nbsp;            int item, CrosshairState crosshairState, int pass) {
&nbsp;
&nbsp;        // setup for collecting optional entity info...
<b class="nc">&nbsp;        EntityCollection entities = null;</b>
<b class="nc">&nbsp;        if (info != null) {</b>
<b class="nc">&nbsp;            entities = info.getOwner().getEntityCollection();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        BoxAndWhiskerXYDataset boxAndWhiskerData</b>
&nbsp;                = (BoxAndWhiskerXYDataset) dataset;
&nbsp;
<b class="nc">&nbsp;        Number x = boxAndWhiskerData.getX(series, item);</b>
<b class="nc">&nbsp;        Number yMax = boxAndWhiskerData.getMaxRegularValue(series, item);</b>
<b class="nc">&nbsp;        Number yMin = boxAndWhiskerData.getMinRegularValue(series, item);</b>
<b class="nc">&nbsp;        Number yMedian = boxAndWhiskerData.getMedianValue(series, item);</b>
<b class="nc">&nbsp;        Number yAverage = boxAndWhiskerData.getMeanValue(series, item);</b>
<b class="nc">&nbsp;        Number yQ1Median = boxAndWhiskerData.getQ1Value(series, item);</b>
<b class="nc">&nbsp;        Number yQ3Median = boxAndWhiskerData.getQ3Value(series, item);</b>
&nbsp;
<b class="nc">&nbsp;        double xx = domainAxis.valueToJava2D(x.doubleValue(), dataArea,</b>
<b class="nc">&nbsp;                plot.getDomainAxisEdge());</b>
&nbsp;
<b class="nc">&nbsp;        RectangleEdge location = plot.getRangeAxisEdge();</b>
<b class="nc">&nbsp;        double yyMax = rangeAxis.valueToJava2D(yMax.doubleValue(), dataArea,</b>
&nbsp;                location);
<b class="nc">&nbsp;        double yyMin = rangeAxis.valueToJava2D(yMin.doubleValue(), dataArea,</b>
&nbsp;                location);
<b class="nc">&nbsp;        double yyMedian = rangeAxis.valueToJava2D(yMedian.doubleValue(),</b>
&nbsp;                dataArea, location);
<b class="nc">&nbsp;        double yyAverage = 0.0;</b>
<b class="nc">&nbsp;        if (yAverage != null) {</b>
<b class="nc">&nbsp;            yyAverage = rangeAxis.valueToJava2D(yAverage.doubleValue(),</b>
&nbsp;                    dataArea, location);
&nbsp;        }
<b class="nc">&nbsp;        double yyQ1Median = rangeAxis.valueToJava2D(yQ1Median.doubleValue(),</b>
&nbsp;                dataArea, location);
<b class="nc">&nbsp;        double yyQ3Median = rangeAxis.valueToJava2D(yQ3Median.doubleValue(),</b>
&nbsp;                dataArea, location);
&nbsp;
<b class="nc">&nbsp;        double exactBoxWidth = getBoxWidth();</b>
<b class="nc">&nbsp;        double width = exactBoxWidth;</b>
<b class="nc">&nbsp;        double dataAreaX = dataArea.getHeight();</b>
<b class="nc">&nbsp;        double maxBoxPercent = 0.1;</b>
<b class="nc">&nbsp;        double maxBoxWidth = dataAreaX * maxBoxPercent;</b>
<b class="nc">&nbsp;        if (exactBoxWidth &lt;= 0.0) {</b>
<b class="nc">&nbsp;            int itemCount = boxAndWhiskerData.getItemCount(series);</b>
<b class="nc">&nbsp;            exactBoxWidth = dataAreaX / itemCount * 4.5 / 7;</b>
<b class="nc">&nbsp;            if (exactBoxWidth &lt; 3) {</b>
<b class="nc">&nbsp;                width = 3;</b>
&nbsp;            }
<b class="nc">&nbsp;            else if (exactBoxWidth &gt; maxBoxWidth) {</b>
<b class="nc">&nbsp;                width = maxBoxWidth;</b>
&nbsp;            }
&nbsp;            else {
<b class="nc">&nbsp;                width = exactBoxWidth;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        g2.setPaint(getItemPaint(series, item));</b>
<b class="nc">&nbsp;        Stroke s = getItemStroke(series, item);</b>
<b class="nc">&nbsp;        g2.setStroke(s);</b>
&nbsp;
&nbsp;        // draw the upper shadow
<b class="nc">&nbsp;        g2.draw(new Line2D.Double(yyMax, xx, yyQ3Median, xx));</b>
<b class="nc">&nbsp;        g2.draw(new Line2D.Double(yyMax, xx - width / 2, yyMax,</b>
&nbsp;                xx + width / 2));
&nbsp;
&nbsp;        // draw the lower shadow
<b class="nc">&nbsp;        g2.draw(new Line2D.Double(yyMin, xx, yyQ1Median, xx));</b>
<b class="nc">&nbsp;        g2.draw(new Line2D.Double(yyMin, xx - width / 2, yyMin,</b>
&nbsp;                xx + width / 2));
&nbsp;
&nbsp;        // draw the body
&nbsp;        Shape box;
<b class="nc">&nbsp;        if (yyQ1Median &lt; yyQ3Median) {</b>
<b class="nc">&nbsp;            box = new Rectangle2D.Double(yyQ1Median, xx - width / 2,</b>
&nbsp;                    yyQ3Median - yyQ1Median, width);
&nbsp;        }
&nbsp;        else {
<b class="nc">&nbsp;            box = new Rectangle2D.Double(yyQ3Median, xx - width / 2,</b>
&nbsp;                    yyQ1Median - yyQ3Median, width);
&nbsp;        }
<b class="nc">&nbsp;        if (this.fillBox) {</b>
<b class="nc">&nbsp;            g2.setPaint(lookupBoxPaint(series, item));</b>
<b class="nc">&nbsp;            g2.fill(box);</b>
&nbsp;        }
<b class="nc">&nbsp;        g2.setStroke(getItemOutlineStroke(series, item));</b>
<b class="nc">&nbsp;        g2.setPaint(getItemOutlinePaint(series, item));</b>
<b class="nc">&nbsp;        g2.draw(box);</b>
&nbsp;
&nbsp;        // draw median
<b class="nc">&nbsp;        g2.setPaint(getArtifactPaint());</b>
<b class="nc">&nbsp;        g2.draw(new Line2D.Double(yyMedian,</b>
&nbsp;                xx - width / 2, yyMedian, xx + width / 2));
&nbsp;
&nbsp;        // draw average - SPECIAL AIMS REQUIREMENT
<b class="nc">&nbsp;        if (yAverage != null) {</b>
<b class="nc">&nbsp;            double aRadius = width / 4;</b>
&nbsp;            // here we check that the average marker will in fact be visible
&nbsp;            // before drawing it...
<b class="nc">&nbsp;            if ((yyAverage &gt; (dataArea.getMinX() - aRadius))</b>
<b class="nc">&nbsp;                    &amp;&amp; (yyAverage &lt; (dataArea.getMaxX() + aRadius))) {</b>
<b class="nc">&nbsp;                Ellipse2D.Double avgEllipse = new Ellipse2D.Double(</b>
&nbsp;                        yyAverage - aRadius, xx - aRadius, aRadius * 2,
&nbsp;                        aRadius * 2);
<b class="nc">&nbsp;                g2.fill(avgEllipse);</b>
<b class="nc">&nbsp;                g2.draw(avgEllipse);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        // FIXME: draw outliers
&nbsp;
&nbsp;        // add an entity for the item...
<b class="nc">&nbsp;        if (entities != null &amp;&amp; box.intersects(dataArea)) {</b>
<b class="nc">&nbsp;            addEntity(entities, box, dataset, series, item, yyAverage, xx);</b>
&nbsp;        }
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Draws the visual representation of a single data item.
&nbsp;     *
&nbsp;     * @param g2  the graphics device.
&nbsp;     * @param dataArea  the area within which the plot is being drawn.
&nbsp;     * @param info  collects info about the drawing.
&nbsp;     * @param plot  the plot (can be used to obtain standard color
&nbsp;     *              information etc).
&nbsp;     * @param domainAxis  the domain axis.
&nbsp;     * @param rangeAxis  the range axis.
&nbsp;     * @param dataset  the dataset (must be an instance of
&nbsp;     *                 {@link BoxAndWhiskerXYDataset}).
&nbsp;     * @param series  the series index (zero-based).
&nbsp;     * @param item  the item index (zero-based).
&nbsp;     * @param crosshairState  crosshair information for the plot
&nbsp;     *                        ({@code null} permitted).
&nbsp;     * @param pass  the pass index.
&nbsp;     */
&nbsp;    public void drawVerticalItem(Graphics2D g2, Rectangle2D dataArea,
&nbsp;            PlotRenderingInfo info, XYPlot plot, ValueAxis domainAxis,
&nbsp;            ValueAxis rangeAxis, XYDataset dataset, int series,
&nbsp;            int item, CrosshairState crosshairState, int pass) {
&nbsp;
&nbsp;        // setup for collecting optional entity info...
<b class="fc">&nbsp;        EntityCollection entities = null;</b>
<b class="fc">&nbsp;        if (info != null) {</b>
<b class="nc">&nbsp;            entities = info.getOwner().getEntityCollection();</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        BoxAndWhiskerXYDataset boxAndWhiskerData</b>
&nbsp;            = (BoxAndWhiskerXYDataset) dataset;
&nbsp;
<b class="fc">&nbsp;        Number x = boxAndWhiskerData.getX(series, item);</b>
<b class="fc">&nbsp;        Number yMax = boxAndWhiskerData.getMaxRegularValue(series, item);</b>
<b class="fc">&nbsp;        Number yMin = boxAndWhiskerData.getMinRegularValue(series, item);</b>
<b class="fc">&nbsp;        Number yMedian = boxAndWhiskerData.getMedianValue(series, item);</b>
<b class="fc">&nbsp;        Number yAverage = boxAndWhiskerData.getMeanValue(series, item);</b>
<b class="fc">&nbsp;        Number yQ1Median = boxAndWhiskerData.getQ1Value(series, item);</b>
<b class="fc">&nbsp;        Number yQ3Median = boxAndWhiskerData.getQ3Value(series, item);</b>
<b class="fc">&nbsp;        List yOutliers = boxAndWhiskerData.getOutliers(series, item);</b>
&nbsp;        // yOutliers can be null, but we&#39;d prefer it to be an empty list in
&nbsp;        // that case...
<b class="fc">&nbsp;        if (yOutliers == null) {</b>
<b class="fc">&nbsp;            yOutliers = Collections.EMPTY_LIST;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        double xx = domainAxis.valueToJava2D(x.doubleValue(), dataArea,</b>
<b class="fc">&nbsp;                plot.getDomainAxisEdge());</b>
&nbsp;
<b class="fc">&nbsp;        RectangleEdge location = plot.getRangeAxisEdge();</b>
<b class="fc">&nbsp;        double yyMax = rangeAxis.valueToJava2D(yMax.doubleValue(), dataArea,</b>
&nbsp;                location);
<b class="fc">&nbsp;        double yyMin = rangeAxis.valueToJava2D(yMin.doubleValue(), dataArea,</b>
&nbsp;                location);
<b class="fc">&nbsp;        double yyMedian = rangeAxis.valueToJava2D(yMedian.doubleValue(),</b>
&nbsp;                dataArea, location);
<b class="fc">&nbsp;        double yyAverage = 0.0;</b>
<b class="fc">&nbsp;        if (yAverage != null) {</b>
<b class="fc">&nbsp;            yyAverage = rangeAxis.valueToJava2D(yAverage.doubleValue(),</b>
&nbsp;                    dataArea, location);
&nbsp;        }
<b class="fc">&nbsp;        double yyQ1Median = rangeAxis.valueToJava2D(yQ1Median.doubleValue(),</b>
&nbsp;                dataArea, location);
<b class="fc">&nbsp;        double yyQ3Median = rangeAxis.valueToJava2D(yQ3Median.doubleValue(),</b>
&nbsp;                dataArea, location);
&nbsp;        double yyOutlier;
&nbsp;
<b class="fc">&nbsp;        double exactBoxWidth = getBoxWidth();</b>
<b class="fc">&nbsp;        double width = exactBoxWidth;</b>
<b class="fc">&nbsp;        double dataAreaX = dataArea.getMaxX() - dataArea.getMinX();</b>
<b class="fc">&nbsp;        double maxBoxPercent = 0.1;</b>
<b class="fc">&nbsp;        double maxBoxWidth = dataAreaX * maxBoxPercent;</b>
<b class="fc">&nbsp;        if (exactBoxWidth &lt;= 0.0) {</b>
<b class="nc">&nbsp;            int itemCount = boxAndWhiskerData.getItemCount(series);</b>
<b class="nc">&nbsp;            exactBoxWidth = dataAreaX / itemCount * 4.5 / 7;</b>
<b class="nc">&nbsp;            if (exactBoxWidth &lt; 3) {</b>
<b class="nc">&nbsp;                width = 3;</b>
&nbsp;            }
<b class="nc">&nbsp;            else if (exactBoxWidth &gt; maxBoxWidth) {</b>
<b class="nc">&nbsp;                width = maxBoxWidth;</b>
&nbsp;            }
&nbsp;            else {
<b class="nc">&nbsp;                width = exactBoxWidth;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        g2.setPaint(getItemPaint(series, item));</b>
<b class="fc">&nbsp;        Stroke s = getItemStroke(series, item);</b>
<b class="fc">&nbsp;        g2.setStroke(s);</b>
&nbsp;
&nbsp;        // draw the upper shadow
<b class="fc">&nbsp;        g2.draw(new Line2D.Double(xx, yyMax, xx, yyQ3Median));</b>
<b class="fc">&nbsp;        g2.draw(new Line2D.Double(xx - width / 2, yyMax, xx + width / 2,</b>
&nbsp;                yyMax));
&nbsp;
&nbsp;        // draw the lower shadow
<b class="fc">&nbsp;        g2.draw(new Line2D.Double(xx, yyMin, xx, yyQ1Median));</b>
<b class="fc">&nbsp;        g2.draw(new Line2D.Double(xx - width / 2, yyMin, xx + width / 2,</b>
&nbsp;                yyMin));
&nbsp;
&nbsp;        // draw the body
&nbsp;        Shape box;
<b class="fc">&nbsp;        if (yyQ1Median &gt; yyQ3Median) {</b>
<b class="fc">&nbsp;            box = new Rectangle2D.Double(xx - width / 2, yyQ3Median, width,</b>
&nbsp;                    yyQ1Median - yyQ3Median);
&nbsp;        }
&nbsp;        else {
<b class="nc">&nbsp;            box = new Rectangle2D.Double(xx - width / 2, yyQ1Median, width,</b>
&nbsp;                    yyQ3Median - yyQ1Median);
&nbsp;        }
<b class="fc">&nbsp;        if (this.fillBox) {</b>
<b class="fc">&nbsp;            g2.setPaint(lookupBoxPaint(series, item));</b>
<b class="fc">&nbsp;            g2.fill(box);</b>
&nbsp;        }
<b class="fc">&nbsp;        g2.setStroke(getItemOutlineStroke(series, item));</b>
<b class="fc">&nbsp;        g2.setPaint(getItemOutlinePaint(series, item));</b>
<b class="fc">&nbsp;        g2.draw(box);</b>
&nbsp;
&nbsp;        // draw median
<b class="fc">&nbsp;        g2.setPaint(getArtifactPaint());</b>
<b class="fc">&nbsp;        g2.draw(new Line2D.Double(xx - width / 2, yyMedian, xx + width / 2,</b>
&nbsp;                yyMedian));
&nbsp;
<b class="fc">&nbsp;        double aRadius = 0;                 // average radius</b>
<b class="fc">&nbsp;        double oRadius = width / 3;    // outlier radius</b>
&nbsp;
&nbsp;        // draw average - SPECIAL AIMS REQUIREMENT
<b class="fc">&nbsp;        if (yAverage != null) {</b>
<b class="fc">&nbsp;            aRadius = width / 4;</b>
&nbsp;            // here we check that the average marker will in fact be visible
&nbsp;            // before drawing it...
<b class="fc">&nbsp;            if ((yyAverage &gt; (dataArea.getMinY() - aRadius))</b>
<b class="fc">&nbsp;                    &amp;&amp; (yyAverage &lt; (dataArea.getMaxY() + aRadius))) {</b>
<b class="nc">&nbsp;                Ellipse2D.Double avgEllipse = new Ellipse2D.Double(xx - aRadius,</b>
&nbsp;                        yyAverage - aRadius, aRadius * 2, aRadius * 2);
<b class="nc">&nbsp;                g2.fill(avgEllipse);</b>
<b class="nc">&nbsp;                g2.draw(avgEllipse);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        List outliers = new ArrayList();</b>
<b class="fc">&nbsp;        OutlierListCollection outlierListCollection</b>
&nbsp;                = new OutlierListCollection();
&nbsp;
&nbsp;        /* From outlier array sort out which are outliers and put these into
&nbsp;         * an arraylist. If there are any farouts, set the flag on the
&nbsp;         * OutlierListCollection
&nbsp;         */
<b class="fc">&nbsp;        for (int i = 0; i &lt; yOutliers.size(); i++) {</b>
<b class="nc">&nbsp;            double outlier = ((Number) yOutliers.get(i)).doubleValue();</b>
<b class="nc">&nbsp;            if (outlier &gt; boxAndWhiskerData.getMaxOutlier(series,</b>
<b class="nc">&nbsp;                    item).doubleValue()) {</b>
<b class="nc">&nbsp;                outlierListCollection.setHighFarOut(true);</b>
&nbsp;            }
<b class="nc">&nbsp;            else if (outlier &lt; boxAndWhiskerData.getMinOutlier(series,</b>
<b class="nc">&nbsp;                    item).doubleValue()) {</b>
<b class="nc">&nbsp;                outlierListCollection.setLowFarOut(true);</b>
&nbsp;            }
<b class="nc">&nbsp;            else if (outlier &gt; boxAndWhiskerData.getMaxRegularValue(series,</b>
<b class="nc">&nbsp;                    item).doubleValue()) {</b>
<b class="nc">&nbsp;                yyOutlier = rangeAxis.valueToJava2D(outlier, dataArea,</b>
&nbsp;                        location);
<b class="nc">&nbsp;                outliers.add(new Outlier(xx, yyOutlier, oRadius));</b>
&nbsp;            }
<b class="nc">&nbsp;            else if (outlier &lt; boxAndWhiskerData.getMinRegularValue(series,</b>
<b class="nc">&nbsp;                    item).doubleValue()) {</b>
<b class="nc">&nbsp;                yyOutlier = rangeAxis.valueToJava2D(outlier, dataArea,</b>
&nbsp;                        location);
<b class="nc">&nbsp;                outliers.add(new Outlier(xx, yyOutlier, oRadius));</b>
&nbsp;            }
<b class="nc">&nbsp;            Collections.sort(outliers);</b>
&nbsp;        }
&nbsp;
&nbsp;        // Process outliers. Each outlier is either added to the appropriate
&nbsp;        // outlier list or a new outlier list is made
<b class="fc">&nbsp;        for (Iterator iterator = outliers.iterator(); iterator.hasNext();) {</b>
<b class="nc">&nbsp;            Outlier outlier = (Outlier) iterator.next();</b>
<b class="nc">&nbsp;            outlierListCollection.add(outlier);</b>
<b class="nc">&nbsp;        }</b>
&nbsp;
&nbsp;        // draw yOutliers
<b class="fc">&nbsp;        double maxAxisValue = rangeAxis.valueToJava2D(rangeAxis.getUpperBound(),</b>
&nbsp;                dataArea, location) + aRadius;
<b class="fc">&nbsp;        double minAxisValue = rangeAxis.valueToJava2D(rangeAxis.getLowerBound(),</b>
&nbsp;                dataArea, location) - aRadius;
&nbsp;
&nbsp;        // draw outliers
<b class="fc">&nbsp;        for (Iterator iterator = outlierListCollection.iterator();</b>
<b class="fc">&nbsp;                iterator.hasNext();) {</b>
<b class="nc">&nbsp;            OutlierList list = (OutlierList) iterator.next();</b>
<b class="nc">&nbsp;            Outlier outlier = list.getAveragedOutlier();</b>
<b class="nc">&nbsp;            Point2D point = outlier.getPoint();</b>
&nbsp;
<b class="nc">&nbsp;            if (list.isMultiple()) {</b>
<b class="nc">&nbsp;                drawMultipleEllipse(point, width, oRadius, g2);</b>
&nbsp;            }
&nbsp;            else {
<b class="nc">&nbsp;                drawEllipse(point, oRadius, g2);</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;
&nbsp;        // draw farout
<b class="fc">&nbsp;        if (outlierListCollection.isHighFarOut()) {</b>
<b class="nc">&nbsp;            drawHighFarOut(aRadius, g2, xx, maxAxisValue);</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (outlierListCollection.isLowFarOut()) {</b>
<b class="nc">&nbsp;            drawLowFarOut(aRadius, g2, xx, minAxisValue);</b>
&nbsp;        }
&nbsp;
&nbsp;        // add an entity for the item...
<b class="fc">&nbsp;        if (entities != null &amp;&amp; box.intersects(dataArea)) {</b>
<b class="nc">&nbsp;            addEntity(entities, box, dataset, series, item, xx, yyAverage);</b>
&nbsp;        }
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Draws an ellipse to represent an outlier.
&nbsp;     *
&nbsp;     * @param point  the location.
&nbsp;     * @param oRadius  the radius.
&nbsp;     * @param g2  the graphics device.
&nbsp;     */
&nbsp;    protected void drawEllipse(Point2D point, double oRadius, Graphics2D g2) {
<b class="nc">&nbsp;        Ellipse2D.Double dot = new Ellipse2D.Double(point.getX() + oRadius / 2,</b>
<b class="nc">&nbsp;                point.getY(), oRadius, oRadius);</b>
<b class="nc">&nbsp;        g2.draw(dot);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Draws two ellipses to represent overlapping outliers.
&nbsp;     *
&nbsp;     * @param point  the location.
&nbsp;     * @param boxWidth  the box width.
&nbsp;     * @param oRadius  the radius.
&nbsp;     * @param g2  the graphics device.
&nbsp;     */
&nbsp;    protected void drawMultipleEllipse(Point2D point, double boxWidth,
&nbsp;                                       double oRadius, Graphics2D g2) {
&nbsp;
<b class="nc">&nbsp;        Ellipse2D.Double dot1 = new Ellipse2D.Double(point.getX()</b>
<b class="nc">&nbsp;                - (boxWidth / 2) + oRadius, point.getY(), oRadius, oRadius);</b>
<b class="nc">&nbsp;        Ellipse2D.Double dot2 = new Ellipse2D.Double(point.getX()</b>
<b class="nc">&nbsp;                + (boxWidth / 2), point.getY(), oRadius, oRadius);</b>
<b class="nc">&nbsp;        g2.draw(dot1);</b>
<b class="nc">&nbsp;        g2.draw(dot2);</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Draws a triangle to indicate the presence of far out values.
&nbsp;     *
&nbsp;     * @param aRadius  the radius.
&nbsp;     * @param g2  the graphics device.
&nbsp;     * @param xx  the x value.
&nbsp;     * @param m  the max y value.
&nbsp;     */
&nbsp;    protected void drawHighFarOut(double aRadius, Graphics2D g2, double xx,
&nbsp;            double m) {
<b class="nc">&nbsp;        double side = aRadius * 2;</b>
<b class="nc">&nbsp;        g2.draw(new Line2D.Double(xx - side, m + side, xx + side, m + side));</b>
<b class="nc">&nbsp;        g2.draw(new Line2D.Double(xx - side, m + side, xx, m));</b>
<b class="nc">&nbsp;        g2.draw(new Line2D.Double(xx + side, m + side, xx, m));</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Draws a triangle to indicate the presence of far out values.
&nbsp;     *
&nbsp;     * @param aRadius  the radius.
&nbsp;     * @param g2  the graphics device.
&nbsp;     * @param xx  the x value.
&nbsp;     * @param m  the min y value.
&nbsp;     */
&nbsp;    protected void drawLowFarOut(double aRadius, Graphics2D g2, double xx,
&nbsp;            double m) {
<b class="nc">&nbsp;        double side = aRadius * 2;</b>
<b class="nc">&nbsp;        g2.draw(new Line2D.Double(xx - side, m - side, xx + side, m - side));</b>
<b class="nc">&nbsp;        g2.draw(new Line2D.Double(xx - side, m - side, xx, m));</b>
<b class="nc">&nbsp;        g2.draw(new Line2D.Double(xx + side, m - side, xx, m));</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Tests this renderer for equality with another object.
&nbsp;     *
&nbsp;     * @param obj  the object ({@code null} permitted).
&nbsp;     *
&nbsp;     * @return {@code true} or {@code false}.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public boolean equals(Object obj) {
<b class="fc">&nbsp;        if (obj == this) {</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
<b class="fc">&nbsp;        if (!(obj instanceof XYBoxAndWhiskerRenderer)) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
<b class="fc">&nbsp;        if (!super.equals(obj)) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
<b class="fc">&nbsp;        XYBoxAndWhiskerRenderer that = (XYBoxAndWhiskerRenderer) obj;</b>
<b class="fc">&nbsp;        if (this.boxWidth != that.getBoxWidth()) {</b>
<b class="fc">&nbsp;            return false;</b>
&nbsp;        }
<b class="fc">&nbsp;        if (!PaintUtils.equal(this.boxPaint, that.boxPaint)) {</b>
<b class="fc">&nbsp;            return false;</b>
&nbsp;        }
<b class="fc">&nbsp;        if (!PaintUtils.equal(this.artifactPaint, that.artifactPaint)) {</b>
<b class="fc">&nbsp;            return false;</b>
&nbsp;        }
<b class="fc">&nbsp;        if (this.fillBox != that.fillBox) {</b>
<b class="fc">&nbsp;            return false;</b>
&nbsp;        }
<b class="fc">&nbsp;        return true;</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Provides serialization support.
&nbsp;     *
&nbsp;     * @param stream  the output stream.
&nbsp;     *
&nbsp;     * @throws IOException  if there is an I/O error.
&nbsp;     */
&nbsp;    private void writeObject(ObjectOutputStream stream) throws IOException {
<b class="fc">&nbsp;        stream.defaultWriteObject();</b>
<b class="fc">&nbsp;        SerialUtils.writePaint(this.boxPaint, stream);</b>
<b class="fc">&nbsp;        SerialUtils.writePaint(this.artifactPaint, stream);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Provides serialization support.
&nbsp;     *
&nbsp;     * @param stream  the input stream.
&nbsp;     *
&nbsp;     * @throws IOException  if there is an I/O error.
&nbsp;     * @throws ClassNotFoundException  if there is a classpath problem.
&nbsp;     */
&nbsp;    private void readObject(ObjectInputStream stream)
&nbsp;        throws IOException, ClassNotFoundException {
&nbsp;
<b class="fc">&nbsp;        stream.defaultReadObject();</b>
<b class="fc">&nbsp;        this.boxPaint = SerialUtils.readPaint(stream);</b>
<b class="fc">&nbsp;        this.artifactPaint = SerialUtils.readPaint(stream);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns a clone of the renderer.
&nbsp;     *
&nbsp;     * @return A clone.
&nbsp;     *
&nbsp;     * @throws CloneNotSupportedException  if the renderer cannot be cloned.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public Object clone() throws CloneNotSupportedException {
<b class="fc">&nbsp;        return super.clone();</b>
&nbsp;    }
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2022-10-20 10:56</div>
</div>
</body>
</html>
